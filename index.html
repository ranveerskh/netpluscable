<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>net+TV</title>
<meta name="theme-color" content="#6a11cb" />
<style>
  :root{
    --bg:#0b1020;--ink:#e9edff;--muted:#9aa7d9;--card:#121831;--line:#23305b;
    --accent1:#6a11cb;--accent2:#2575fc;--ok:#32d296;--whats:#25D366;--warn:#f8b84a;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;font-family:ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,Arial;
    background:
      radial-gradient(1200px 700px at 80% -10%,rgba(138,91,255,.14),transparent 60%),
      radial-gradient(900px 700px at 0% 0%,rgba(37,117,252,.14),transparent 55%),
      linear-gradient(180deg,#0b1020,#0b1020);
    color:var(--ink);
    padding-bottom: calc(88px + env(safe-area-inset-bottom));
  }
  a{color:inherit;text-decoration:none}
  .wrap{max-width:1100px;margin:0 auto;padding:14px}

  /* Swipe Promo Carousel (sticky) */
  .promo{
    position:sticky;top:0;z-index:1000;background:transparent;padding:8px 0 4px;
    animation:bannerSlide .5s ease-out;
  }
  #promoTrack{display:flex;gap:10px;overflow:auto;scroll-snap-type:x mandatory;padding:0 14px}
  .slide{
    scroll-snap-align:center;min-width:92%;
    background:linear-gradient(135deg,var(--accent1),var(--accent2));
    color:#fff;border-radius:14px;padding:12px 14px;position:relative;
    box-shadow:0 6px 20px rgba(0,0,0,.25);
  }
  .slide .t{font-weight:900}
  .slide .x{position:absolute;right:8px;top:8px;background:rgba(255,255,255,.18);border:1px solid rgba(255,255,255,.45);border-radius:10px;padding:4px 8px;font-weight:900;cursor:pointer}
  .slide a{font-weight:900;text-decoration:underline}
  @keyframes bannerSlide{from{transform:translateY(-100%);opacity:0}to{transform:translateY(0);opacity:1}}

  /* Header */
  .top{
    position:sticky;top:0;z-index:900;backdrop-filter: blur(8px);
    background:rgba(11,16,32,.6);border-bottom:1px solid rgba(255,255,255,.06);
    display:flex;align-items:center;justify-content:space-between;padding:12px 14px;
  }
  .logo{display:flex;align-items:center;gap:4px;color:var(--ink);font-weight:800}
  .logo svg{height:26px;width:auto}
  .menu-btn{background:transparent;border:1px solid rgba(255,255,255,.15);color:var(--ink);
    padding:6px 10px;border-radius:10px}

  /* Hero */
  .hero{padding:10px 14px 8px;text-align:center}
  .hero h1{font-size:24px;letter-spacing:.5px;margin:6px 0 10px}
  .badges{display:flex;gap:8px;flex-wrap:wrap;justify-content:center}
  .badge{font-size:12px;color:#cbd5ff;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.12);padding:6px 8px;border-radius:999px}

  /* Tabs */
  .tabs{display:flex;gap:8px;margin:14px 0 8px}
  .tab{flex:1;text-align:center;color:var(--ink);background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.12);padding:12px;border-radius:12px;font-weight:800}
  .tab.active{background:linear-gradient(135deg,var(--accent1),var(--accent2));border-color:transparent}

  /* Panels */
  .panel{display:none}
  .panel.active{display:block}

  /* Cards grid */
  .grid{display:grid;gap:12px}
  @media(min-width:680px){.grid{grid-template-columns: repeat(2,1fr)}}
  @media(min-width:1024px){.grid{grid-template-columns: repeat(3,1fr)}}
  .card{
    background:var(--card);border:1px solid var(--line);border-radius:16px;padding:16px;
    box-shadow:0 10px 30px rgba(0,0,0,.25);
  }
  .mark{display:inline-block;font-size:11px;margin-bottom:6px;padding:4px 8px;border-radius:999px;background:#0e1a3d;border:1px solid rgba(255,255,255,.12);color:#bcd0ff;font-weight:800}
  .mark.rec{background:#14224f;border-color:#3e5cdf;color:#cfe2ff}
  .mark.dur{background:#10311f;border-color:#2f7d55;color:#c9f6e4}
  .row{display:flex;align-items:center;justify-content:space-between;gap:8px}
  .title{font-weight:900;font-size:18px}
  .price{font-weight:900;font-size:18px;background:rgba(255,255,255,.06);padding:6px 10px;border-radius:10px;border:1px solid rgba(255,255,255,.12)}
  ul.features{list-style:none;padding:0;margin:10px 0 0}
  ul.features li{margin:6px 0;font-size:13px;color:#cfdbff}
  .btns{display:flex;gap:8px;margin-top:12px}
  .btn{flex:1;padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,.16);color:var(--ink);background:transparent;font-weight:800;cursor:pointer}
  .btn.primary{background:linear-gradient(135deg,var(--accent1),var(--accent2));border-color:transparent}
  .btn.whats{background:var(--whats);border-color:transparent;color:#fff}
  .note{font-size:12px;color:#ffdca1;margin-top:6px}

  /* Combo chip */
  .combo{
    display:inline-block;margin-top:8px;padding:7px 12px;border-radius:10px;font-weight:900;font-size:13px;color:#fff;
    background:linear-gradient(135deg,#6a11cb,#2575fc);box-shadow:0 6px 16px rgba(37,117,252,.25)
  }

  /* Table */
  .table{margin-top:12px;overflow:auto;border:1px solid var(--line);border-radius:12px}
  table{width:100%;border-collapse:collapse}
  th,td{padding:12px;border-bottom:1px solid rgba(255,255,255,.06);font-size:13px}
  thead th{background:#0e1836;color:#cfe0ff;text-align:left}

  /* Bottom Dock (now 5 tabs incl. Gallery) */
  .dock{
    position:sticky;bottom:0;z-index:40;background:rgba(11,16,32,.92);backdrop-filter: blur(10px);
    border-top:1px solid rgba(255,255,255,.08);display:grid;grid-template-columns:repeat(5,1fr);gap:8px;
    padding:8px 8px calc(8px + env(safe-area-inset-bottom));
  }
  .dbtn{color:var(--ink);text-align:center;padding:10px 6px;border:1px solid rgba(255,255,255,.12);border-radius:12px}
  .dactive{background:linear-gradient(135deg,var(--accent1),var(--accent2));border-color:transparent}

  /* Modals / Sheets */
  .modal{position:fixed;inset:0;background:rgba(0,0,0,.55);display:none;align-items:flex-end;z-index:9999}
  .sheet{
    background:#0d142d;border-top:1px solid var(--line);width:100%;
    max-height:90vh;overflow:auto;-webkit-overflow-scrolling:touch;overscroll-behavior:contain;
    border-radius:16px 16px 0 0;padding:16px 14px calc(24px + env(safe-area-inset-bottom));
    color:#e9edff
  }
  .field{display:flex;flex-direction:column;gap:6px;margin:10px 0}
  .input,select,textarea{background:#0b122a;border:1px solid #22305a;border-radius:10px;padding:12px;color:#e9edff}
  .chips{display:flex;gap:6px;flex-wrap:wrap}
  .chip{background:#0b122a;border:1px solid #22305a;color:#cfe0ff;padding:6px 10px;border-radius:999px;font-size:12px}
  .x{float:right;background:transparent;border:1px solid rgba(255,255,255,.15);color:#cfe0ff;border-radius:10px;padding:6px 10px}
  .help{font-size:12px;color:#b6c7ff}
  .cols{display:grid;gap:12px;margin-top:8px}
  @media(min-width:720px){.cols{grid-template-columns:1fr 1fr}}
  .h{font-weight:900;margin-top:8px}
  .catlist{margin:6px 0 0;padding-left:18px}
  .catlist li{margin:6px 0}

  /* Gallery grid */
  .gallery{display:grid;grid-template-columns:repeat(2,1fr);gap:8px;margin-top:8px}
  @media(min-width:700px){.gallery{grid-template-columns:repeat(4,1fr)}}
  .gitem{background:#0b122a;border:1px solid #22305a;border-radius:12px;overflow:hidden}
  .gitem img{width:100%;height:120px;object-fit:cover;display:block}
  .gcap{padding:8px;font-size:12px;color:#cfe0ff;text-align:center}

  /* Simple photo scroller inside cards */
  .photoTrack{display:flex;gap:8px;overflow:auto;scroll-snap-type:x mandatory;margin:8px 0}
  .photoTrack img{height:140px;width:auto;border-radius:10px;scroll-snap-align:center;display:block}
  .photoDots{display:flex;gap:4px;margin-top:4px}
  .dot{width:6px;height:6px;border-radius:999px;background:#2a335e}
  .dot.on{background:#8ea2ff}

  /* Lock page scroll when a modal is open (iOS friendly) */
  body.modal-open{overflow:hidden;position:fixed;width:100%}
</style>
</head>
<body>

<!-- Swipe Promo (from Admin banners via Firestore) -->
<section id="promoCarousel" class="promo" role="region" aria-label="Offers" style="display:none">
  <div id="promoTrack"></div>
</section>

<!-- Header -->
<header class="top">
  <div class="logo" aria-label="net+TV">
    <svg viewBox="0 0 180 36" role="img" aria-label="net+TV logo">
      <defs><linearGradient id="g" x1="0" y1="0" x2="1" y2="1"><stop offset="0" stop-color="#6a11cb"/><stop offset="1" stop-color="#2575fc"/></linearGradient></defs>
      <text x="0" y="25" font-size="24" font-weight="800" fill="#ffffff">net</text>
      <rect x="52" y="6" width="24" height="24" rx="6" fill="url(#g)"/>
      <rect x="62" y="10" width="4" height="16" fill="#fff"/><rect x="56" y="16" width="16" height="4" fill="#fff"/>
      <text x="90" y="25" font-size="24" font-weight="900" fill="#e9edff">TV</text>
    </svg>
  </div>
  <button class="menu-btn" onclick="openSheet('menu')">Menu</button>
</header>

<!-- Hero -->
<section class="hero wrap">
  <h1>All TV. All VOD.</h1>
  <div class="badges">
    <span class="badge">10,000+ Channels</span>
    <span class="badge">Movies ‚Ä¢ Sports ‚Ä¢ Series</span>
    <span class="badge">Full HD & 4K</span>
    <span class="badge">24/7 Support</span>
  </div>

  <div class="tabs" role="tablist" aria-label="Primary sections">
    <button class="tab active" id="tab-plans" onclick="showPanel('plans')">Plans</button>
    <button class="tab" id="tab-boxes" onclick="showPanel('boxes')">Boxes</button>
    <button class="tab" id="tab-gallery" onclick="showPanel('gallery')">Gallery</button>
    <button class="tab" id="tab-recharge" onclick="showPanel('recharge')">Recharge</button>
    <button class="tab" id="tab-support" onclick="showPanel('support')">Support</button>
  </div>
</section>

<!-- Main -->
<main class="wrap">

  <!-- Plans -->
  <div class="panel active" id="panel-plans">
    <div id="plansGrid" class="grid"></div>

    <!-- Table generated from same plans -->
    <div class="table">
      <table aria-label="Plan comparison">
        <thead><tr><th>Plan</th><th>Duration</th><th>Price</th><th>Note</th></tr></thead>
        <tbody id="plansTableBody"></tbody>
      </table>
    </div>
  </div>

  <!-- Boxes -->
  <div class="panel" id="panel-boxes">
    <div id="boxesGrid" class="grid"></div>
  </div>

  <!-- Gallery -->
  <div class="panel" id="panel-gallery">
    <div class="card">
      <div class="title">Gallery</div>
      <div class="sub" style="color:var(--muted)">Curated images</div>
      <div id="galleryGrid" class="gallery"></div>
    </div>
  </div>

  <!-- Recharge -->
  <div class="panel" id="panel-recharge">
    <div class="card">
      <div class="title">Recharge</div>
      <div class="sub" style="color:var(--muted)">Fast renewal via WhatsApp</div>

      <div class="field"><label>Name</label><input class="input" id="rcName" placeholder="Full Name"></div>
      <div class="field"><label>User ID</label><input class="input" id="rcUser" placeholder="e.g., STB MAC / ID"></div>
      <div class="field"><label>Email</label><input class="input" id="rcEmail" placeholder="email@example.com" type="email"></div>

      <div class="field">
        <label>Plan</label>
        <select id="rcPlan" class="input">
          <option value="">Choose a plan</option>
        </select>
      </div>

      <button class="btn whats" onclick="sendRecharge()">Recharge via WhatsApp</button>
      <div class="help">We reply quickly.</div>
    </div>
  </div>

  <!-- Support -->
  <div class="panel" id="panel-support">
    <div class="card">
      <div class="title">We‚Äôre here 24/7</div>
      <div class="sub" style="color:var(--muted)">Install ‚Ä¢ Issues ‚Ä¢ Upgrades</div>
      <div class="btns">
        <a class="btn whats" id="waSupport" href="#" target="_blank" rel="noopener">Chat on WhatsApp</a>
      </div>
      <ul class="features" style="margin-top:8px">
        <li>üì¶ Quick activation after payment</li>
        <li>üõ† Remote setup help</li>
        <li>üîí No hidden charges</li>
      </ul>
    </div>

    <!-- General Request -->
    <div class="card" style="margin-top:12px">
      <div class="title">General Request</div>
      <div class="sub" style="color:var(--muted)">Tell us what you need ‚Äî we‚Äôll reply on WhatsApp</div>

      <div class="field"><label>Name</label><input class="input" id="reqName" placeholder="Full Name"></div>
      <div class="field"><label>Phone (WhatsApp)</label><input class="input" id="reqPhone" placeholder="+1 ..."></div>
      <div class="field"><label>Email</label><input class="input" id="reqEmail" placeholder="email@example.com" type="email"></div>
      <div class="field"><label>Details</label><textarea class="input" id="reqNote" placeholder="Write your request..." rows="3"></textarea></div>

      <button class="btn whats" onclick="sendRequest()">Send Request via WhatsApp</button>
      <div class="help">We usually respond within minutes.</div>
    </div>

    <!-- Parental PIN -->
    <div class="card" style="margin-top:12px">
      <div class="title">Parental PIN Request</div>
      <div class="sub" style="color:var(--muted)">Enter your device MAC and email</div>

      <div class="field"><label>Device MAC Address</label><input class="input" id="pinMac" placeholder="e.g., 00:1A:79:xx:xx:xx"></div>
      <div class="field"><label>Email</label><input class="input" id="pinEmail" placeholder="email@example.com" type="email"></div>
      <div class="field"><label>Note (optional)</label><input class="input" id="pinNote" placeholder="Any extra info..."></div>

      <button class="btn whats" onclick="sendPin()">Request PIN via WhatsApp</button>
      <div class="help">We‚Äôll verify the device and send your PIN.</div>
    </div>
  </div>
</main>

<!-- Bottom dock -->
<nav class="dock wrap" aria-label="Quick navigation">
  <a class="dbtn dactive" href="#plans" onclick="showPanel('plans')">Plans</a>
  <a class="dbtn" href="#boxes" onclick="showPanel('boxes')">Boxes</a>
  <a class="dbtn" href="#gallery" onclick="showPanel('gallery')">Gallery</a>
  <a class="dbtn" href="#recharge" onclick="showPanel('recharge')">Recharge</a>
  <a class="dbtn" href="#support" onclick="showPanel('support')">Support</a>
</nav>

<!-- Menu sheet -->
<div class="modal" id="sheet-menu" aria-hidden="true">
  <div class="sheet">
    <button class="x" onclick="closeSheet('menu')">Close</button>
    <h3>Menu</h3>
    <div class="chips" style="margin:8px 0 12px">
      <span class="chip" onclick="showPanel('plans');closeSheet('menu')">Plans</span>
      <span class="chip" onclick="showPanel('boxes');closeSheet('menu')">Boxes</span>
      <span class="chip" onclick="showPanel('gallery');closeSheet('menu')">Gallery</span>
      <span class="chip" onclick="showPanel('recharge');closeSheet('menu')">Recharge</span>
      <span class="chip" onclick="showPanel('support');closeSheet('menu')">Support</span>
    </div>
    <p class="help">All TV. All VOD. One app. Full HD & 4K where available.</p>
    <div class="btns">
      <a class="btn whats" id="waSubscribeMenu" href="#" target="_blank" rel="noopener">Subscribe on WhatsApp</a>
    </div>
  </div>
</div>

<script type="module">
  /* ===== Firebase (CDN) for banners only ===== */
  import { getApps, initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
  import { getFirestore, collection, query, orderBy, getDocs } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBOEuLTwXHlgwCeUJk-8zHLjtsljr-5CFM",
    authDomain: "netplustv-90b29.firebaseapp.com",
    projectId: "netplustv-90b29",
    storageBucket: "netplustv-90b29.firebasestorage.app",
    messagingSenderId: "639722274355",
    appId: "1:639722274355:web:ebe34fdf093f8191da2d46"
  };
  const app = getApps().length ? getApps()[0] : initializeApp(firebaseConfig);
  const db  = getFirestore(app);

  /* ===== Banners from Firestore ===== */
  async function loadBanners(){
    const wrap = document.getElementById('promoCarousel');
    const track = document.getElementById('promoTrack');
    try{
      track.innerHTML='';
      const snap = await getDocs(query(collection(db,'site_settings','banners','items'), orderBy('order','asc')));
      const nowStr = new Date().toISOString().slice(0,10);
      const items = [];
      snap.forEach(d=>{
        const b = d.data();
        if(b.enabled===false) return;
        if(b.validFrom && nowStr < b.validFrom) return;
        if(b.validTo && nowStr > b.validTo) return;
        items.push({id:d.id,...b});
      });
      if(!items.length){ wrap.style.display='none'; return; }
      wrap.style.display='block';
      for(const b of items){
        const el = document.createElement('div');
        el.className='slide';
        el.innerHTML = `
          <button class="x" aria-label="Close" onclick="this.closest('.slide').remove()">&times;</button>
          <div class="t">${b.title||''}</div>
          <div style="margin:6px 0">${b.text||''}</div>
          ${b.ctaLabel? `<a href="${b.ctaHref||'#'}">${b.ctaLabel}</a>`:''}
          ${b.imageUrl? `<img src="${b.imageUrl}" alt="" style="position:absolute;right:10px;bottom:10px;max-height:42px;border-radius:8px">`:''}
        `;
        track.appendChild(el);
      }
    }catch(e){
      wrap.style.display='none';
    }
  }
  loadBanners();
</script>

<script>
  /* ===== Bullet-proof SETTINGS loader with migration ===== */
  const KEY = 'netplus.settings.v1.public';
  const CANDIDATES = [
    'netplus.settings.v1.public',
    'netplus.settings.v1',
    'netplus.settings'
  ];
  function defaultSettings(){
    return {
      currency:{symbol:'$', position:'prefix'},
      whatsapp:{number:'16476961656'},
      plans:[
        {id:'p1', name:'1 Month', months:1, price:15, badge:'Starter', order:0, visible:true, note:'Full features'},
        {id:'p3', name:'3 Months', months:3, price:40, badge:'Popular', order:1, visible:true, note:'Save vs monthly'},
        {id:'p6', name:'6 Months', months:6, price:65, badge:'Most Picked', order:2, visible:true},
        {id:'p12', name:'12 Months (+1 free)', months:12, price:100, badge:'Best Value', order:3, visible:true, note:'+1 month free'}
      ],
      boxes:[],
      gallery:[]
    };
  }
  function loadSettings(){
    let obj=null;
    for(const k of CANDIDATES){
      const raw = localStorage.getItem(k);
      if(raw){ try{ obj = JSON.parse(raw); if(obj) break; }catch(_){/*ignore*/} }
    }
    if(!obj || typeof obj!=='object') obj = defaultSettings();

    // minimal schema healing
    obj.currency = obj.currency || {symbol:'$', position:'prefix'};
    obj.whatsapp = obj.whatsapp || {number:'16476961656'};
    obj.plans = Array.isArray(obj.plans)? obj.plans : [];
    obj.boxes = Array.isArray(obj.boxes)? obj.boxes : [];
    obj.gallery = Array.isArray(obj.gallery)? obj.gallery : [];

    // persist to canonical key so admin/index stay in sync
    localStorage.setItem(KEY, JSON.stringify(obj));
    return obj;
  }
  let SITE = loadSettings();

  /* ===== Helpers ===== */
  function money(n){
    const s = SITE.currency?.symbol || '$';
    const suf = SITE.currency?.position === 'suffix';
    const val = Number(n||0);
    return suf ? `${val}${s}` : `${s}${val}`;
  }
  function waLink(text){
    const num = (SITE.whatsapp?.number||'16476961656').replace(/[^\d]/g,'');
    return `https://wa.me/${num}?text=${encodeURIComponent(text)}`;
  }

  /* ===== Panels / tabs ===== */
  function showPanel(name){
    document.querySelectorAll('.panel').forEach(p=>p.classList.remove('active'));
    document.querySelector('#panel-'+name).classList.add('active');
    document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
    const tId = {plans:'tab-plans',boxes:'tab-boxes',gallery:'tab-gallery',recharge:'tab-recharge',support:'tab-support'}[name];
    if(tId) document.getElementById(tId).classList.add('active');
    document.querySelectorAll('.dbtn').forEach(b=>b.classList.remove('dactive'));
    const idx={plans:0,boxes:1,gallery:2,recharge:3,support:4}[name];document.querySelectorAll('.dbtn')[idx].classList.add('dactive');
    window.scrollTo({top:0,behavior:'smooth'});
  }
  window.showPanel = showPanel;

  /* ===== Modals ===== */
  let _scrollY = 0;
  function openSheet(key){
    _scrollY = window.scrollY || window.pageYOffset;
    document.body.classList.add('modal-open');
    document.body.style.top = `-${_scrollY}px`;
    const el = document.getElementById('sheet-'+key);
    el.style.display = 'flex';
    el.addEventListener('click', backdropCloser);
    const sheetEl = el.querySelector('.sheet');
    if (sheetEl) sheetEl.addEventListener('click', e => e.stopPropagation());
  }
  function backdropCloser(e){
    if(e.target.classList.contains('modal')){
      const id = e.currentTarget.id.replace('sheet-','');
      closeSheet(id);
    }
  }
  function closeSheet(key){
    const el = document.getElementById('sheet-'+key);
    if(!el) return;
    el.style.display = 'none';
    el.removeEventListener('click', backdropCloser);
    document.body.classList.remove('modal-open');
    document.body.style.top = '';
    window.scrollTo(0, _scrollY);
  }
  window.openSheet=openSheet; window.closeSheet=closeSheet;

  /* ===== WhatsApp helpers ===== */
  function waSend(msg){ window.open(waLink(msg),'_blank'); }
  window.waSend = waSend;

  /* ===== Render: Plans ===== */
  function renderPlans(){
    const grid = document.getElementById('plansGrid');
    const tbody = document.getElementById('plansTableBody');
    const rcSel = document.getElementById('rcPlan');
    grid.innerHTML=''; tbody.innerHTML=''; rcSel.innerHTML='<option value="">Choose a plan</option>';

    const list = [...SITE.plans].filter(p=>p.visible!==false).sort((a,b)=>(a.order||0)-(b.order||0));
    for(const p of list){
      const card = document.createElement('div');
      card.className='card';
      card.innerHTML = `
        ${p.badge? `<span class="mark">${p.badge}</span>`:''}
        <div class="row"><div class="title">${p.name||''}</div><div class="price">${money(p.price)}</div></div>
        ${p.note? `<div class="note">${p.note}</div>`:''}
        <ul class="features">
          <li>‚ö° Quick Activation</li>
          <li>üì° 20,000+ Live Channels</li>
          <li>üé¨ All Shows, Movies & PPV</li>
          <li>üìö Latest & Classic Series/Movies</li>
          <li>üñ•Ô∏è Full HD & SD Channels</li>
          <li>‚ùÑÔ∏è AntiFreeze Technology</li>
          <li>üí¨ 24/7 WhatsApp Support</li>
        </ul>
        <div class="btns">
          <button class="btn primary whats">Subscribe</button>
          <button class="btn" onclick="openSheet('info')">Info</button>
        </div>
      `;
      card.querySelector('.whats').onclick = ()=>subscribePlan(p.name, p.price);
      grid.appendChild(card);

      const days = p.months ? (p.months*30) : (p.name||'').toLowerCase().includes('trial')? 2 : '';
      const tr = document.createElement('tr');
      tr.innerHTML = `<td>${p.name||''}</td><td>${days? `${days} days`:'‚Äî'}</td><td>${money(p.price)}</td><td>${p.note||''}</td>`;
      tbody.appendChild(tr);

      const opt = document.createElement('option');
      opt.value = p.name; opt.textContent = `${p.name} - ${money(p.price)}`;
      rcSel.appendChild(opt);
    }
  }

  /* ===== Render: Boxes ===== */
  function renderBoxes(){
    const grid = document.getElementById('boxesGrid'); grid.innerHTML='';
    const list = [...SITE.boxes].filter(b=>b.visible!==false).sort((a,b)=>(a.order||0)-(b.order||0));
    for(const b of list){
      const card = document.createElement('div'); card.className='card';

      // photos
      let photosHTML = '';
      if(Array.isArray(b.images) && b.images.length){
        const pid = 'p'+Math.random().toString(36).slice(2);
        photosHTML = `
          <div id="${pid}" class="photoTrack" aria-label="Photos">
            ${b.images.map(i=>`<img src="${i.url}" alt="${i.alt||''}" loading="lazy">`).join('')}
          </div>
        `;
      }

      card.innerHTML = `
        ${b.badge? `<span class="mark">${b.badge}</span>`:''}
        <div class="row"><div class="title">${b.name||''}</div><div class="price">${money(b.price)}</div></div>
        ${b.bundle? `<div class="combo">Box + 1-Year: ${money(b.bundle)}</div>`:''}
        ${photosHTML}
        <ul class="features">
          ${(b.specs||[]).map(s=>`<li>${s}</li>`).join('')}
        </ul>
        <div class="btns">
          <button class="btn" onclick="buyBox('${(b.name||'').replace(/'/g,'\\\'')}',${Number(b.price)||0})">Box Only</button>
          <button class="btn whats" ${b.bundle? '' : 'disabled'} onclick="buyBoxBundle('${(b.name||'').replace(/'/g,'\\\'')}',${Number(b.bundle)||0})">Box + 1-Year</button>
        </div>
      `;
      grid.appendChild(card);
    }
  }

  /* ===== Render: Gallery ===== */
  function renderGallery(){
    const grid = document.getElementById('galleryGrid'); grid.innerHTML='';
    const list = [...SITE.gallery].filter(g=>g.visible!==false).sort((a,b)=>(a.order||0)-(b.order||0));
    if(!list.length){
      grid.innerHTML = `<div class="help">No images yet.</div>`;
      return;
    }
    for(const g of list){
      const item = document.createElement('div');
      item.className = 'gitem';
      item.innerHTML = `
        <img src="${g.url}" alt="${g.caption||''}" loading="lazy" />
        <div class="gcap">${g.caption||''}</div>
      `;
      item.onclick = ()=>{ if(g.url) window.open(g.url,'_blank'); };
      grid.appendChild(item);
    }
  }

  /* ===== CTAs using WA number from settings ===== */
  function wireWhatsAppLinks(){
    const subHref = waLink('Hi, I want to subscribe to net+TV.');
    document.getElementById('waSubscribeMenu').href = subHref;
    document.getElementById('waSupport').href = waLink('Hi, I need help with net+TV.');
  }

  /* ===== Existing CTA helpers ===== */
  function subscribePlan(label,price){
    waSend(`New Subscription\nPlan: ${label} - ${money(price)}\nSource: website`);
  }
  function buyBox(name,price){
    waSend(`I'm interested in: Box Only\nModel: ${name}\nPrice: ${money(price)}\nPlease guide me with purchase & setup.`);
  }
  function buyBoxBundle(name,price){
    waSend(`I'm interested in: ${name} + 12-Month Plan\nBundle Price: ${money(price)}\nPlease guide me with activation & setup.`);
  }
  function sendRecharge(){
    const n=(document.getElementById('rcName').value||'').trim();
    const u=(document.getElementById('rcUser').value||'').trim();
    const e=(document.getElementById('rcEmail').value||'').trim();
    const p=document.getElementById('rcPlan').value||'';
    waSend(`Recharge Request\nName: ${n}\nUser ID: ${u}\nEmail: ${e}\nPlan: ${p}`);
  }
  function sendRequest(){
    const n=(document.getElementById('reqName').value||'').trim();
    const ph=(document.getElementById('reqPhone').value||'').trim();
    const e=(document.getElementById('reqEmail').value||'').trim();
    const note=(document.getElementById('reqNote').value||'').trim();
    waSend(`General Request\nName: ${n}\nPhone: ${ph}\nEmail: ${e}\nDetails: ${note}`);
  }
  function sendPin(){
    const mac=(document.getElementById('pinMac').value||'').trim();
    const e=(document.getElementById('pinEmail').value||'').trim();
    const note=(document.getElementById('pinNote').value||'').trim();
    waSend(`Parental PIN Request\nMAC: ${mac}\nEmail: ${e}\nNote: ${note}`);
  }
  window.subscribePlan=subscribePlan; window.buyBox=buyBox; window.buyBoxBundle=buyBoxBundle;
  window.sendRecharge=sendRecharge; window.sendRequest=sendRequest; window.sendPin=sendPin;

  /* ===== Init render ===== */
  function renderAll(){
    // reload from canonical key in case admin changed it in another tab
    try{ SITE = JSON.parse(localStorage.getItem(KEY)) || SITE; }catch(_){}
    renderPlans();
    renderBoxes();
    renderGallery();
    wireWhatsAppLinks();
  }
  renderAll();

  // Optional: react to storage changes from another tab on the same origin
  window.addEventListener('storage', e=>{
    if(e.key === KEY){ try{ SITE = JSON.parse(e.newValue); renderAll(); }catch(_){} }
  });
</script>
</body>
</html>