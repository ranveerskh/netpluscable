<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="viewport-fit=cover, width=device-width, initial-scale=1">
<title>net+TV Admin</title>
<meta name="theme-color" content="#0b1020">
<style>
  :root{
    --bg:#0b1020;--ink:#e9edff;--muted:#a9b5e6;--card:#121831;--line:#23305b;
    --g1:#6a11cb;--g2:#2575fc;--tap:44px;
    --safe-top: env(safe-area-inset-top,0px);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,Arial;background:#0b1020;color:var(--ink);-webkit-font-smoothing:antialiased}
  a{color:inherit;text-decoration:none}
  .wrap{max-width:1100px;margin:0 auto;padding:16px}

  /* Topbar */
  .topbar{position:sticky;top:0;z-index:100;background:rgba(11,16,32,.9);backdrop-filter:blur(12px);border-bottom:1px solid rgba(255,255,255,.08)}
  .bar{display:grid;grid-template-columns:1fr auto;gap:12px;align-items:center;padding:10px 16px;padding-top:calc(10px + var(--safe-top))}
  .brand{display:flex;gap:10px;align-items:center;font-weight:900}
  .badge{background:linear-gradient(135deg,var(--g1),var(--g2));padding:6px 10px;border-radius:10px;font-weight:900}
  .auth{display:flex;gap:8px;align-items:center;flex-wrap:wrap;justify-content:flex-end}
  .chip{border:1px solid var(--line);border-radius:999px;padding:8px 12px;background:#0f1732}
  .btn{border:1px solid rgba(255,255,255,.16);border-radius:12px;padding:12px 14px;font-weight:800;background:#0f1732;color:var(--ink);cursor:pointer;min-height:var(--tap)}
  .btn.primary{background:linear-gradient(135deg,var(--g1),var(--g2));border-color:transparent;color:#fff}
  .input{background:#0b122a;border:1px solid #22305a;border-radius:12px;padding:12px 14px;color:#e9edff;min-height:var(--tap)}

  /* 2x2 main links */
  .ql-wrap{padding:10px 16px;border-top:1px solid rgba(255,255,255,.08)}
  .ql-grid{display:grid;gap:10px;grid-template-columns:repeat(2, minmax(0,1fr))}
  .qbtn{display:flex;align-items:center;justify-content:center;text-align:center;font-weight:900;padding:16px;border-radius:14px;border:1px solid rgba(255,255,255,.12);background:#0f1732}
  .qbtn.primary{background:linear-gradient(135deg,var(--g1),var(--g2));border-color:transparent}

  /* Nav buttons to panels */
  .tools{display:flex;gap:10px;flex-wrap:wrap;margin:10px 16px}
  .tbtn{padding:12px 14px;border-radius:12px;border:1px solid var(--line);background:#0f1732;font-weight:800}

  /* Sections */
  .section{padding:16px}
  .sub{color:#a9b5e6;font-size:13px}
  .cards{display:grid;gap:12px}
  @media(min-width:900px){.cards{grid-template-columns:repeat(4,1fr)}}
  .card{background:var(--card);border:1px solid var(--line);border-radius:16px;padding:16px}
  .kpi-val{font-size:28px;font-weight:900;line-height:1.1;margin-top:6px}

  /* Panel containers */
  .panel{display:none}
  .panel.active{display:block}

  /* Hosts pills */
  .pill{display:inline-block;margin:6px 8px 0 0;padding:8px 12px;border:1px solid var(--line);border-radius:999px;background:#0f1732;font-size:13px}

  /* Lists for banners/gallery */
  .grid2{display:grid;gap:10px}
  @media(min-width:900px){.grid2{grid-template-columns:1fr 1fr}}
  .item{display:grid;grid-template-columns:1fr auto;gap:8px;background:#0f1732;border:1px solid rgba(255,255,255,.1);border-radius:12px;padding:10px;margin-top:8px}
  .actions{display:flex;gap:8px;align-items:center}
</style>
</head>
<body>

<!-- Topbar -->
<div class="topbar">
  <div class="bar">
    <div class="brand"><span class="badge">net+TV</span> <span>Admin</span></div>

    <!-- Right-corner auth -->
    <div class="auth" id="authArea">
      <input id="email" class="input" placeholder="Admin email" autocomplete="username" inputmode="email">
      <input id="password" class="input" placeholder="Password" type="password" autocomplete="current-password">
      <button class="btn primary" id="btnSignIn">Sign In</button>
    </div>
    <div class="auth" id="whoami" style="display:none">
      <span id="whoamiText" class="chip"></span>
      <button class="btn" id="btnSignOut">Sign Out</button>
    </div>
  </div>

  <!-- 2x2 grid of the four main buttons -->
  <div class="ql-wrap">
    <div class="ql-grid">
      <a class="qbtn primary" href="https://beta.gpanel.me/login" target="_blank" rel="noopener">Glow TV</a>
      <a class="qbtn" href="https://bill.spicetv.cc/login" target="_blank" rel="noopener">Spice TV</a>
      <a class="qbtn" href="https://fast4k.cc/login" target="_blank" rel="noopener">Smart4K TV</a>
      <a class="qbtn" href="data.html" target="_blank" rel="noopener">Users Data</a>
    </div>
  </div>

  <!-- Buttons to in-page panels -->
  <div class="tools">
    <button class="tbtn" onclick="showPanel('home')">Home</button>
    <button class="tbtn" onclick="showPanel('hosts')">Hosts</button>
    <button class="tbtn" onclick="showPanel('banners')">Banners</button>
    <button class="tbtn" onclick="showPanel('gallery')">Gallery</button>
  </div>
</div>

<!-- PANELS -->
<div class="wrap">

  <!-- HOME: KPIs only -->
  <section id="panel-home" class="panel active section">
    <div class="sub" style="margin-bottom:10px">
      Unique Visitors and Pings are filtered strictly to <code>/index.html</code>.
    </div>
    <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap;margin-bottom:10px">
      <label class="sub" for="range">Range</label>
      <select id="range" class="input">
        <option value="7d">Last 7 days</option>
        <option value="30d">Last 30 days</option>
        <option value="1y">Last 1 year</option>
        <option value="all">Lifetime</option>
      </select>
      <button class="btn" id="refreshKPI">Refresh</button>
    </div>

    <div class="cards">
      <div class="card"><div class="sub">Unique Visitors (human, daily, index.html)</div><div class="kpi-val" id="kpiVisitors">—</div></div>
      <div class="card"><div class="sub">Pings in Range (index.html)</div><div class="kpi-val" id="kpiPings">—</div></div>
      <div class="card"><div class="sub">Avg Steps (today)</div><div class="kpi-val" id="kpiAvgStepsToday">—</div></div>
      <div class="card"><div class="sub">Avg Steps (session)</div><div class="kpi-val" id="kpiAvgStepsSession">—</div></div>
    </div>
    <div class="sub" id="humanExplain" style="margin-top:8px"></div>
  </section>

  <!-- HOSTS panel -->
  <section id="panel-hosts" class="panel section">
    <h3 style="margin:0 0 8px 0">Hosts</h3>
    <div class="sub" style="margin-bottom:8px">Tap to open; long-press to copy.</div>
    <a class="pill" href="http://glotv.me" target="_blank" rel="noopener">Glow TV: glotv.me</a>
    <a class="pill" href="http://4k.spicetv.cc" target="_blank" rel="noopener">Spice TV: 4k.spicetv.cc</a>
    <a class="pill" href="http://smart4k.me" target="_blank" rel="noopener">Smart4K TV: smart4k.me</a>
  </section>

  <!-- BANNERS panel -->
  <section id="panel-banners" class="panel section">
    <h3 style="margin:0 0 8px 0">Swipe Banners</h3>
    <div class="sub">Only enabled banners within date window are displayed on site.</div>
    <div class="grid2" style="margin-top:12px">
      <label style="display:flex;align-items:center;gap:8px"><input type="checkbox" id="bnEnabled" checked> <span class="sub">Enabled</span></label>
      <input class="input" id="bnTitle" placeholder="Title (e.g., Canada Day Offer)">
      <input class="input" id="bnText" placeholder="Text (e.g., Get 1 month extra with 1-year)">
      <input class="input" id="bnCtaLabel" placeholder="CTA label (e.g., Get 13 months)">
      <input class="input" id="bnCtaHref" placeholder="CTA href (https:// or #)">
      <input class="input" id="bnImageUrl" placeholder="Image URL (optional)">
      <input class="input" id="bnValidFrom" type="date" placeholder="Valid from">
      <input class="input" id="bnValidTo" type="date" placeholder="Valid to">
      <input class="input" id="bnOrder" type="number" placeholder="Order (0..N)">
      <button class="btn primary" id="bnSave">Save New Banner</button>
    </div>
    <div class="sub" id="bnStatus" style="margin-top:6px"></div>
    <div id="bannerList"></div>
  </section>

  <!-- GALLERY panel -->
  <section id="panel-gallery" class="panel section">
    <h3 style="margin:0 0 8px 0">Gallery</h3>
    <div class="sub">Shown in Menu → Gallery modal on site.</div>
    <div class="grid2" style="margin-top:12px">
      <input class="input" id="glName" placeholder="Name / caption">
      <input class="input" id="glImageUrl" placeholder="Image URL (https://...)">
      <input class="input" id="glOrder" type="number" placeholder="Order (0..N)">
      <button class="btn primary" id="glSave">Add Item</button>
    </div>
    <div class="sub" id="glStatus" style="margin-top:6px"></div>
    <div id="galleryList"></div>
  </section>

</div>

<script type="module">
/* Firebase */
import { initializeApp, getApps } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
import {
  getFirestore, collection, query, orderBy, limit, getDocs,
  doc, addDoc, setDoc, getDoc, deleteDoc, serverTimestamp
} from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBOEuLTwXHlgwCeUJk-8zHLjtsljr-5CFM",
  authDomain: "netplustv-90b29.firebaseapp.com",
  projectId: "netplustv-90b29",
  storageBucket: "netplustv-90b29.firebasestorage.app",
  messagingSenderId: "639722274355",
  appId: "1:639722274355:web:ebe34fdf093f8191da2d46"
};
const app = getApps().length? getApps()[0] : initializeApp(firebaseConfig);
const auth = getAuth(app);
const db   = getFirestore(app);

/* DOM */
const $ = s => document.querySelector(s);
function showPanel(name){
  ['home','hosts','banners','gallery'].forEach(n=>{
    $('#panel-'+n).classList.toggle('active', n===name);
    window.scrollTo({top:0,behavior:'smooth'});
  });
}
window.showPanel = showPanel;

/* Auth */
$('#btnSignIn').addEventListener('click', async ()=>{
  const email=$('#email').value.trim(), pass=$('#password').value;
  if(!email||!pass) return alert('Enter email and password');
  try{ await signInWithEmailAndPassword(auth,email,pass); }catch(e){ alert('Sign in failed: '+(e?.message||e)); }
});
$('#btnSignOut').addEventListener('click',()=>signOut(auth));

onAuthStateChanged(auth, async (user)=>{
  if(user){
    $('#authArea').style.display='none';
    $('#whoami').style.display='flex';
    $('#whoamiText').textContent = user.email || '';
    await refreshAll();
  }else{
    $('#authArea').style.display='flex';
    $('#whoami').style.display='none';
    $('#bannerList').innerHTML='';
    $('#galleryList').innerHTML='';
    ['kpiVisitors','kpiPings','kpiAvgStepsToday','kpiAvgStepsSession','humanExplain'].forEach(id=>$('#'+id).textContent='');
  }
});

/* Range helper */
function rangeToStart(range){
  const now = new Date();
  if(range==='7d')  return new Date(now.getTime()-7*24*3600*1000);
  if(range==='30d') return new Date(now.getTime()-30*24*3600*1000);
  if(range==='1y')  return new Date(now.getTime()-365*24*3600*1000);
  return null;
}

/* ===== KPIs (Home) =====
   Strictly count docs with pagePath === "/index.html"
   Also prefer human-filtered uniques via isHuman/humanScore when present.
*/
const HOMEPAGE_PATH = "/index.html";
let visCache=[];
async function loadAnalytics(){
  const start = rangeToStart($('#range').value);
  const snap = await getDocs(query(collection(db,'analytics_visitors'), orderBy('createdAt','desc'), limit(1200)));
  visCache = snap.docs.map(d=>({id:d.id, ...d.data()})).filter(r=>{
    const t = r.createdAt?.toDate?.() || (r.ts? new Date(r.ts) : null);
    const path = String(r.pagePath || "").toLowerCase();
    const inHome = path === HOMEPAGE_PATH;
    return inHome && (!start || (t && t>=start));
  });
}
function renderKPIs(){
  const uniqueHuman=new Set();
  const uniqueAny=new Set();
  let pings=0,sumT=0,sumS=0,nT=0,nS=0;

  visCache.forEach(r=>{
    const t=r.createdAt?.toDate?.() || (r.ts?new Date(r.ts):null);
    const day = t ? t.toISOString().slice(0,10) : null;
    const key = (day && r.vid) ? `${day}|${r.vid}` : null;

    pings++;

    if(typeof r.steps_today==='number'){ sumT+=r.steps_today; nT++; }
    if(typeof r.steps_session==='number'){ sumS+=r.steps_session; nS++; }

    if(key){ uniqueAny.add(key); }

    const isHuman = r.isHuman === true || (typeof r.humanScore === 'number' && r.humanScore >= 3);
    if(key && isHuman){ uniqueHuman.add(key); }
  });

  const finalUnique = uniqueHuman.size>0 ? uniqueHuman.size : uniqueAny.size;

  $('#kpiVisitors').textContent = String(finalUnique);
  $('#kpiPings').textContent    = String(pings);
  $('#kpiAvgStepsToday').textContent   = nT? (sumT/nT).toFixed(1):'0.0';
  $('#kpiAvgStepsSession').textContent = nS? (sumS/nS).toFixed(1):'0.0';

  $('#humanExplain').textContent = uniqueHuman.size>0
    ? `Filtered by pagePath=/index.html. Human-filtered uniques: ${uniqueHuman.size}.`
    : `Filtered by pagePath=/index.html. No human flags yet; showing basic uniques.`;
}
async function refreshKPIs(){ await loadAnalytics(); renderKPIs(); }
$('#range').addEventListener('change', refreshKPIs);
$('#refreshKPI').addEventListener('click', refreshKPIs);

/* ===== Banners CRUD ===== */
async function loadBanners(){
  const snap = await getDocs(query(collection(db,'site_settings','banners','items'), orderBy('order','asc')));
  const list = $('#bannerList'); list.innerHTML='';
  snap.forEach(docSnap=>{
    const b = { id: docSnap.id, ...docSnap.data() };
    const row = document.createElement('div'); row.className='item'; row.innerHTML = `
      <div>
        <div class="h">${b.title||'(no title)'} ${b.enabled? '' : '<span class="sub">[disabled]</span>'}</div>
        <div class="sub">${b.text||''}</div>
        <div class="sub">CTA: ${b.ctaLabel||''} → ${(b.ctaHref||'').slice(0,80)}</div>
        <div class="sub">Order: ${b.order??0} | Valid: ${(b.validFrom||'')||'—'} → ${(b.validTo||'')||'—'}</div>
        <div class="sub">${b.imageUrl? 'Image: '+b.imageUrl : ''}</div>
      </div>
      <div class="actions">
        <button class="btn" data-act="toggle" data-id="${b.id}">${b.enabled? 'Disable' : 'Enable'}</button>
        <button class="btn" data-act="edit" data-id="${b.id}">Edit</button>
        <button class="btn" data-act="del" data-id="${b.id}">Delete</button>
      </div>
    `;
    list.appendChild(row);
  });
  list.querySelectorAll('button[data-act]').forEach(btn=>{
    btn.addEventListener('click', async ()=>{
      const id = btn.dataset.id, act = btn.dataset.act;
      const ref = doc(db,'site_settings','banners','items',id);
      if(act==='toggle'){
        const snap = await getDoc(ref); const cur = snap.data();
        await setDoc(ref,{enabled:!cur.enabled, updatedAt:serverTimestamp()},{merge:true});
      }else if(act==='edit'){
        const snap = await getDoc(ref); const b = snap.data();
        $('#bnEnabled').checked = !!b.enabled;
        $('#bnTitle').value = b.title||''; $('#bnText').value=b.text||'';
        $('#bnCtaLabel').value=b.ctaLabel||''; $('#bnCtaHref').value=b.ctaHref||'';
        $('#bnImageUrl').value=b.imageUrl||''; $('#bnValidFrom').value=b.validFrom||''; $('#bnValidTo').value=b.validTo||'';
        $('#bnOrder').value=b.order??0;
        $('#bnSave').dataset.editId = id; $('#bnSave').textContent='Save Changes';
        $('#bnStatus').textContent='Loaded for editing';
        setTimeout(()=>$('#bnStatus').textContent='',1500);
        window.scrollTo({top:0,behavior:'smooth'});
      }else if(act==='del'){
        if(confirm('Delete this banner?')){ await deleteDoc(ref); }
      }
      await loadBanners();
    });
  });
}
$('#bnSave').addEventListener('click', async ()=>{
  const payload = {
    enabled: $('#bnEnabled').checked,
    title: $('#bnTitle').value.trim(),
    text: $('#bnText').value.trim(),
    ctaLabel: $('#bnCtaLabel').value.trim(),
    ctaHref: $('#bnCtaHref').value.trim(),
    imageUrl: $('#bnImageUrl').value.trim() || null,
    validFrom: $('#bnValidFrom').value || null,
    validTo: $('#bnValidTo').value || null,
    order: Number($('#bnOrder').value||0),
    updatedAt: serverTimestamp()
  };
  const editId = $('#bnSave').dataset.editId;
  if(editId){
    await setDoc(doc(db,'site_settings','banners','items',editId), payload, {merge:true});
    $('#bnSave').textContent='Save New Banner';
    delete $('#bnSave').dataset.editId;
    $('#bnStatus').textContent='Saved ✔';
  }else{
    payload.createdAt = serverTimestamp();
    await addDoc(collection(db,'site_settings','banners','items'), payload);
    $('#bnStatus').textContent='Created ✔';
  }
  setTimeout(()=>$('#bnStatus').textContent='',1500);
  $('#bnTitle').value=''; $('#bnText').value=''; $('#bnCtaLabel').value=''; $('#bnCtaHref').value=''; $('#bnImageUrl').value=''; $('#bnOrder').value='';
  await loadBanners();
});

/* ===== Gallery CRUD ===== */
async function loadGallery(){
  const snap = await getDocs(query(collection(db,'site_settings','gallery','items'), orderBy('order','asc')));
  const list = $('#galleryList'); list.innerHTML='';
  snap.forEach(docSnap=>{
    const g = { id: docSnap.id, ...docSnap.data() };
    const row = document.createElement('div'); row.className='item'; row.innerHTML = `
      <div>
        <div class="h">${g.name||'(no name)'}</div>
        <div class="sub">${g.imageUrl||''}</div>
        <div class="sub">Order: ${g.order??0}</div>
      </div>
      <div class="actions">
        <button class="btn" data-gact="edit" data-id="${g.id}">Edit</button>
        <button class="btn" data-gact="del" data-id="${g.id}">Delete</button>
      </div>
    `;
    list.appendChild(row);
  });
  list.querySelectorAll('button[data-gact]').forEach(btn=>{
    btn.addEventListener('click', async ()=>{
      const id = btn.dataset.id, act = btn.dataset.gact;
      const ref = doc(db,'site_settings','gallery','items',id);
      if(act==='edit'){
        const snap = await getDoc(ref); const g = snap.data();
        $('#glName').value = g.name||'';
        $('#glImageUrl').value = g.imageUrl||'';
        $('#glOrder').value = g.order??0;
        $('#glSave').dataset.editId = id; $('#glSave').textContent='Save Changes';
        $('#glStatus').textContent='Loaded for editing';
        setTimeout(()=>$('#glStatus').textContent='',1500);
        window.scrollTo({top:0,behavior:'smooth'});
      }else if(act==='del'){
        if(confirm('Delete this gallery item?')){ await deleteDoc(ref); await loadGallery(); }
      }
    });
  });
}
$('#glSave').addEventListener('click', async ()=>{
  const payload = {
    name: $('#glName').value.trim(),
    imageUrl: $('#glImageUrl').value.trim(),
    order: Number($('#glOrder').value||0),
    updatedAt: serverTimestamp()
  };
  if(!payload.imageUrl){ $('#glStatus').textContent='Image URL required'; setTimeout(()=>$('#glStatus').textContent='',1500); return; }
  const editId = $('#glSave').dataset.editId;
  if(editId){
    await setDoc(doc(db,'site_settings','gallery','items',editId), payload, {merge:true});
    $('#glSave').textContent='Add Item';
    delete $('#glSave').dataset.editId;
    $('#glStatus').textContent='Saved ✔';
  }else{
    payload.createdAt = serverTimestamp();
    await addDoc(collection(db,'site_settings','gallery','items'), payload);
    $('#glStatus').textContent='Created ✔';
  }
  setTimeout(()=>$('#glStatus').textContent='',1500);
  $('#glName').value=''; $('#glImageUrl').value=''; $('#glOrder').value='';
  await loadGallery();
});

/* ===== Orchestration ===== */
async function refreshAll(){ await Promise.all([refreshKPIs(), loadBanners(), loadGallery()]); }
</script>

<!-- TRACKER SNIPPET (include on all public pages). It WILL NOT log on admin pages. -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getFirestore, doc, setDoc, updateDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const isAdminPage = /admin/i.test(location.pathname);
if(!isAdminPage){
  const firebaseConfig2 = {
    apiKey: "AIzaSyBOEuLTwXHlgwCeUJk-8zHLjtsljr-5CFM",
    authDomain: "netplustv-90b29.firebaseapp.com",
    projectId: "netplustv-90b29"
  };
  const app2 = initializeApp(firebaseConfig2, "np-human");
  const db2  = getFirestore(app2);

  const ls = window.localStorage;
  function uuid(){return (crypto.randomUUID?crypto.randomUUID():
    'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g,c=>{
      const r=Math.random()*16|0,v=c=='x'?r:(r&0x3|0x8);return v.toString(16);
    })
  );}
  const VID_KEY="npv_vid"; let vid=ls.getItem(VID_KEY); if(!vid){vid=uuid(); ls.setItem(VID_KEY,vid);}
  const SID=uuid(); const startMs=Date.now();

  const analyticsRef = doc(db2,"analytics_visitors",SID);

  let humanScore=0, clicks=0, keys=0, scrollYMax=0, timeActive=0;
  const envInfo={
    ua:navigator.userAgent||"", lang:navigator.language||"",
    tz:Intl.DateTimeFormat().resolvedOptions().timeZone||"",
    w:innerWidth, h:innerHeight,
    // force explicit pagePath; this is what the admin filters on
    pagePath: "/index.html",
    pageTitle: document.title||""
  };

  function bump(p=1){ humanScore=Math.min(8, humanScore+p); flagSoon(); }
  document.addEventListener("click",()=>{clicks++;bump(1);},{passive:true});
  document.addEventListener("keydown",()=>{keys++;bump(1);},{passive:true});
  document.addEventListener("scroll",()=>{ const y=Math.max(scrollYMax, scrollY||document.documentElement.scrollTop||0); if(y>scrollYMax){const d=y-scrollYMax; scrollYMax=y; if(scrollYMax>200 && d>30) bump(1);}},{passive:true});
  setInterval(()=>{ timeActive=Math.floor((Date.now()-startMs)/1000); if([10,30,60].includes(timeActive)) bump(1); },1000);

  let pending=false; async function flagSoon(){
    if(pending) return; pending=true; setTimeout(async ()=>{
      pending=false;
      const payload = {
        vid, isHuman: humanScore>=3, humanScore, clicks, keys, scrollYMax, timeActive,
        createdAt: serverTimestamp(), ...envInfo, steps_today: 0, steps_session: 0
      };
      try{ await updateDoc(analyticsRef, payload); }
      catch{ await setDoc(analyticsRef, payload); }
    }, 1200);
  }

  // first ping quickly
  bump(0.5);
}
</script>
</body>
</html>